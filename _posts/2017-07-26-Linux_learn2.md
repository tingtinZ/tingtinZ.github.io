---
layout: post
title: Linux学习小记2
category: Linux
descriptions: 学习Linux
keywords: Linux shell
---

继昨天学习了Linux的历史简介、特色、与硬件的联系后，今天学习的重点会放在shell部分。

像我们平时的命令行，其实真正指的shell。

<!-- more --> 

## shell提示符

在大多时候，关注的是命令本身，却没有去注意过命令前面的提示符是什么，又是怎么组成的。

打开终端我们总是能看见shell提示符：

```
zhuangtingting@zhuangtingting-VirtualBox:~$
```

不同的发行版可能显示有所不同，但是通常会包括用户名@主机名，当前工作目录和美元符号"$"。

在以往的实践中可以发现，当获得root权限的时候，"$"会变成"#"。

为突出命令，以下的命令将会省略shell提示符。

## 快捷操作

为减少输入命令的负担，这里有一些快捷的操作，让我们更快捷更轻松得编辑命令。

+ 命令历史。

  按上箭头按键，会看到上一条命令重新出现在提示符之后。按下下箭头按键，先前输入的命令就消失了。（在不小心输错命令的某些字母的时候，这简直是福音！）

+ 复制和粘贴

  与平常不同的是，在终端里面，使用`ctrl+c`和`ctrl+v`是不能完成复制粘贴的，它们有着不一样的意义（例如`ctrl+c`是向终端发送signal信号来终止一个进程或任务）。

  还是有办法进行复制粘贴的，这时候`shift+ctrl+c`和`shift+ctrl+v`就可以实现。

  还有一种方法利用鼠标和光标，鼠标左键的拖动（或双击）使某些文本高亮，再按下鼠标中键，就被粘贴在了光标所在的位置。（这个方法我在securecrt里实践过，并不奏效，但是在linux下的终端是可行的。）

+ 命令补全

  输入命令的前个别字母后，`tab`键可以帮助我们自动补全命令。

+ 光标移动

  `ctrl+a`移动光标到行首；`ctrl+e`移动光标到行尾；`ctrl+u` 删除整行；`ctrl+d` 删除单词。

## 通配符

shell提供一些特殊字符来帮助我们快速得根据指定文件名而不需要把文件名的全称输入进去。

- `*` 匹配任意多个字符
- `?` 匹配任意一个字符（不能是0个）
- `[characters]` 匹配任意一个字符集中的字符
- `[!characters]` 匹配任意一个字符集中的字符
- `[[:class:]]` 匹配任意一个不是字符集中的字符

例如，在我的家目录下有文件error.txt和ddes.txt，我使用`cat`命令：

```
$ cat *.txt
ddes
error
```

那么两个文件名都能够被匹配，该命令把两个文件的内容都打印出来了。

## 文件系统树

需要注意的是，Linux只有一个单一的文件系统树，而各个存储设备是挂载到树的各个节点上。比如，存储设备1是挂载到根目录，存储设备 2则是挂载到/home这个目录。当数据放置在/home内的各次目录时，数据是放置到存储设备 2的，如果不是放在/home底下的目录， 那么数据就会被放置到存储设备1。

## I/O重定向

+ 重定向标准输出

  + 使用 “>” 重定向符来重定向标准输出到另一个文件。
  + 使用”>>“操作符，将导致输出结果添加到文件内容之后。

  有一个很简便的功能，我们能够利用标准输出很简单得生成一个文件：

  ```
  $ > f1.txt
  ```

+ 重定向标准输入

  使用“<”重定向符实现标准输入，以此可把标准输入源改成文件，不再仅仅是键盘。

## 管道线

 使用管道操作符`|`，可以使得一个命令的标准输入通过管道送至另一个命令的标准输出。例如：

```
$ ll | sort
```

## 常用命令

文件系统相关命令：

- pwd`显示当前路径

- `cd`  更改路径，后面可以接相对路径或绝对路径（家目录用字符“~”代表），也有如下的快捷键：

  - `cd` 更改工作目录到家目录
  - `cd -`更改目录到先前的工作目录
  - `cd ~user_name` 更改目录到指定用户的家目录

- `ls ` 列出目录下的内容，后面可以接相对路径或绝对路径，接上不同选项有不同的功能（可以接多个），常见的有：

  - `ls -a` 显示所有文件把隐藏目录也显示出来

  - `ls -l` 长格式输出信息，包括权限、用户、文件大小、修改日期、文件名等信息

  - `ls -t `按文件修改时间来排序

  - `ls -S` 按照文件大小排序

  - `ls -d` 显示的是指定目录，而不是目录中的内容

    与`ls`比较一下，能理解得更清楚：

    ```
    $ ls tingtin
    404.html                      css           index.html  Rakefile
    about.md                      feed.xml      js          README.md
    archive.html                  Gemfile       _layouts    _site
    baidu_verify_d9VfWOoEUA.html  Gemfile.lock  love        sketch-web-viewer
    CNAME                         images        nano.save   tags.html
    _config.yml                   _includes     _posts      小说.html

    $ ls -d tingtin
    tingtin
    ```

  - `ls -F` 在每个所列出的名字后面加上一个指示符。例如，如果 目录名，则会加上一个'/'字符。

    需要注意的是，这里的大写是必须要的，如果输入的命令是`ls -f`则会去掉颜色标记。

- `file` 确定文件类型，后面接文件名

- `less` 浏览文件内容

- `cp` 复制文件和目录，这里有一些有用的选项：

  - `cp -u` 仅复制目标目录中不存在的文件，或者是文件内容相比已存在的文件有更新的文件。

  - `cp -a` 复制文件和目录，以及它们的属性。

  - `cp -r` 递归地复制目录及目录中的内容。

    一般情况下，如果目标是个文件，那么目标文件不存在时会创建文件；而如果目标是个目录时，目标目录必须在复制前就已经存在。但是有了`-r` 这个选项后，如果目标目录不存在，则会创建目标目录。

- `mv` 移动/重命名文件和目录。（移动目标是个目录时，可以不存在。）

- `mkdir`创建目录（可以接受多个参数，即一次创建多个目录）

- `rm` 删除文件和目录

  - `rm -r` 如果要删除一个目录，则要指定这个选项。

  需要注意的是，若在`rm` 命令中使用通配符不当，将可能删除所有的文件！例如在“*”后面加了一个空格：

  ```
  $ ls
  f1.txt  f2.txt  h1.html
  $ rm *.txt
  $ ls
  h1.html

  $ ls
  f1.txt  f2.txt  h1.html
  $ rm * .txt
  rm: cannot remove '.txt': No such file or directory
  $ ls
  ```

- `ln` 创建硬链接和符号链接

---

与命令相关的：

+ type` 显示命令类型

+ `which` 显示可执行程序的位置，不包括`cd`等内建命令和命令别名。

+ `help` 得到shell内建命令的帮助文档

+ `man` 显示程序手册页

+ `whatis` 相比冗长的手册页，我们可以用这个命令显示简洁的命令说明

+ `alias` 创建自己的命令，用`unalias` 删除别名。

  注意！在创建之前用`type` 查看命令是否已存在。

---

+ `cat` 连接文件，用来显示文件内容（没有分页）。

- `sort` 排序文本行
- `uniq`  报道或省略重复行
- `grep` 打印匹配行，匹配文件名是否还有某个单词
- `wc` 打印文件中行数，单词数，和字节数
- `head` 输出文件第一部分
  - `head -n`调整打印的行数
- `tail` 输出文件最后一部分
  - `tail -n` 调整打印的行数
- `tee`  从标准输入读取数据，并同时写到标准输出和文件

---

+ `echo` 显示一行文本

  在这里我想到既然能够显示后面所接的文本，那么可以用来配合重定向符号来写文件：

  ```
  $ echo dsfdsaf > error.txt
  $ cat error.txt
  dsfdsaf
  ```

  还能用来作路径名展开，例如：

  ```
  $ echo d*
  data ddes.txt
  ```

  能找到在当前目录下文件名或目录名以d开头的有两个。

  另外，还能执行算术表达式，并显示结果，算数表达式的格式：$((expression))：

  ```
  $ echo $((8/2))       
  4
  ```

  在学习过程中，新get到一个算数操作符“**”，执行取幂操作。

  有一个我比较易错的点是：

  ```
  $ echo {Z..A}
  Z Y X W V U T S R Q P O N M L K J I H G F E D C B A
  ```

  在上面的操作中，如果换作其他操作，会误以为是取花括号中的一个。但实际上花括号这样的功能确实带来了极大的便利，给人一种“批量处理”的感觉。

  有些时候，我们希望不要展开，我们可以使用双引号和单引号。有所区别的是，双引号下参数展开、算术表达式展开和命令替换仍然有效，但是单引号可以禁止所有的展开！

---

- `clear` 清空屏幕

- `history` 显示历史列表内容

  在历史列表中这么多命令里怎么找出我们想要的命令呢？还记得`grep` 命令吗，配合管道线，我们能轻松搜索到我们想要的命令：

  ```
  $ history | grep cat
  ```

  像上面这样，我们可以找到我们用过的`cat` 命令。

- `date ` 显示系统当前时间和日期

- `cal` 显示当前月份的日历

- `df ` 查看磁盘剩余空间的数量

- `free ` 显示空闲内存的数量

- `exit` 终止一个终端会话

---

权限相关：

+ `id` 显示用户信息

+ `passwd` 修改用户密码

+ `chmod` 更改文件权限（文件所有者（u）、文件组所有者（g）和其他人（o）的读、写和执行权限）

+ `umask` 设置默认的文件权限

+ `su` 以另一个用户的身份来运行 shell

+ `sudo` 以另一个用户的身份来执行命令

  su 和 sudo 之间的一个重要区别是 sudo 不会重新启动一个 shell，也不会加载另一个 用户的 shell 运行环境。

---

进程相关：

+ `ps` 报告当前进程

  默认情况下，只列出与当前终端会话相关的进程，如果想得到更多的进行信息，加上选项：

  + `ps x` 列出所拥有的每个进程的信息

+ `top` 显示任务

+ `kill `给一个进程发送信号，后面接上“-9”和进程的PID，常用来“杀死”进程。当然还有其他信号。

+ `shutdown` 关机或重启系统



## 学习中遇到的问题

### 问题1：超级用户和root用户的区别？

解答：超级用户即为root用户。

### 问题2：su 和 sudo 之间的一个重要区别是 sudo 不会重新启动一个 shell，也不会加载另一个 用户的 shell 运行环境？不是很懂

解答：sudo只是临时获得root权限，但却不会重新启动shell，而su 命令以另一个用户身份的 ID 启动一个新的 shell 会话。

### 待了解

umask、进程、su VS su-、

1. 掩码：掩码和chmod的权限值一样，都用八进制都表示。umask总共4位：gid/uid，属主，组权，其它用户的权限。通常用后三位，第一位是较少用到的权限设置：setuid（4000）、setgid（2000）、sticky（1000）。
2. `umask` VS `chmod`：umask是用户创建文件的默认权限，对将要新创建的新文件有影响。chmod是修改文件的权限！
3. 进程好比如任务，正在运行的一个应用程序。进程是程序的实例，通过运行触发程序，加载到内存中成为进程。
4. su VS su-。su和sudo没有切换工作目录和环境变量,只是赋予用户权限,而su -是真正切换到root登录,工作目录切换到/root,环境变量也同时改变。正因为这样，su -使用root的密码,而sudo su使用用户密码。
