<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="keywords" content="Python学习4, 婷婷的博客, ">
  <title>Python学习4 - 婷婷的博客</title>
  <link rel="canonical" href="https://tingtinZ.github.io/2017/08/15/python4_LOCAL_3174.html">
  <link rel="icon" href="/res/img/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/res/img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/res/css/public.css">
  <link rel="stylesheet" href="/res/css/light.css">
  <script src="/res/js/light.js"></script>
  <!-- <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script> -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-88258580-1', 'auto');
  ga('send', 'pageview');

</script>

</head>
<body>
  <div id="blog">
    <div class="sidebar">
  <div class="profilepic">
    <a href="/"><img src="/res/img/me.jpg" alt="logo"></img></a>
  </div>
  <h1 class="title"><a href="/">婷婷的博客</a></h1>
  <h2 class="sub-title"></h2>
  <nav id="nav">
    <ul>
    
      <li><a href="/page/timing.html"><i class="fa fa-clock-o"></i>&nbsp;时间轴</a></li>
    
      <li><a href="/page/category.html"><i class="fa fa-tags"></i>&nbsp;分类</a></li>
    
      <li><a href="/page/read.html"><i class="fa fa-book"></i>&nbsp;阅读</a></li>
    
      <li><a href="/page/about.html"><i class="fa fa-paper-plane-o"></i>&nbsp;关于</a></li>
    
    </ul>
  </nav>  
  <nav id="sub-nav">
    <a class="weibo " href="" title="新浪微博" target="_blank"><i class="fa fa-weibo"></i></a>
    <a class="github" href="https://github.com/tingtinZ" title="GitHub" target="_blank"><i class="fa fa-github fa-2x"></i></a>
    <a class="rss" href="/page/feed.xml" title="RSS订阅" target="_blank"><i class="fa fa-rss"></i></a>
    <a class="search" href="/page/search.html" title="搜索" target="_blank"><i class="fa fa-search"></i></a>
  </nav>
  <div id="license">
    <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" target="_blank" title="本站所有作品采用：&#10;知识共享《署名 非商业性使用 相同方式共享 3.0》&#10;进行许可" >
    <img alt="License" height="31" width="88" src="data:image/png;base64,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" /></a>
  </div>
</div>

    <div class="main">
    <header class="post-header">
  <h1 class="post-title"><a href="/2017/08/15/python4_LOCAL_3174.html">Python学习4</a></h2>
  <p class="post-meta">
    <i class="fa fa-calendar"></i>
    2017年08月15日
    <i class="space"></i>
    
    <i class="fa fa-tags"></i>
    <a class="post-category" href="/page/category.html#Python">Python</a>
    
    
    <a class="post-category" href="/page/category.html#"></a>
    
  </p>
</header>
<div class="post-main">
<p>学习廖雪峰老师的python教程和《python最佳实践指南》，并摘录重点。</p>

<!-- more -->

<h4 id="进程和线程">进程和线程</h4>

<p>Python既支持多进程，又支持多线程。</p>

<ul>
  <li>
    <p>多进程</p>

    <ul>
      <li>
        <p><code class="highlighter-rouge">fork()</code></p>

        <p>Unix/Linux操作系统提供了一个<code class="highlighter-rouge">fork()</code>系统调用，它非常特殊。普通的函数调用，调用一次，返回一次，但是<code class="highlighter-rouge">fork()</code>调用一次，返回两次，因为操作系统自动把当前进程（称为父进程）复制了一份（称为子进程），然后，分别在父进程和子进程内返回。</p>

        <p>子进程永远返回<code class="highlighter-rouge">0</code>，而父进程返回子进程的ID。</p>

        <p>什么意思呢？看看下面的例子：</p>

        <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#!/usr/bin/env python3</span>
<span class="c"># -*- coding:utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="k">print</span><span class="p">(</span><span class="s">'Process (</span><span class="si">%</span><span class="s">s) start...'</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
<span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
<span class="k">if</span> <span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'I am child process (</span><span class="si">%</span><span class="s">s) and my parent is </span><span class="si">%</span><span class="s">s.'</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span> 
<span class="n">os</span><span class="o">.</span><span class="n">getppid</span><span class="p">()))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'I (</span><span class="si">%</span><span class="s">s) just created a child process (</span><span class="si">%</span><span class="s">s).'</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">pid</span>
<span class="p">))</span>

<span class="o">//</span><span class="err">输出结果：</span>
<span class="err">$</span> <span class="n">python3</span> <span class="n">testfork</span><span class="o">.</span><span class="n">py</span>       
<span class="n">Process</span> <span class="p">(</span><span class="mi">2251</span><span class="p">)</span> <span class="n">start</span><span class="o">...</span>
<span class="n">I</span> <span class="p">(</span><span class="mi">2251</span><span class="p">)</span> <span class="n">just</span> <span class="n">created</span> <span class="n">a</span> <span class="n">child</span> <span class="n">process</span> <span class="p">(</span><span class="mi">2252</span><span class="p">)</span><span class="o">.</span>
<span class="n">I</span> <span class="n">am</span> <span class="n">child</span> <span class="n">process</span> <span class="p">(</span><span class="mi">2252</span><span class="p">)</span> <span class="ow">and</span> <span class="n">my</span> <span class="n">parent</span> <span class="ow">is</span> <span class="mf">2251.</span>
</code></pre>
        </div>

        <p>分析：首先打印当前进程的pid(2251)，执行fork()后，当前进程（称为父进程）复制了一份（称为子进程），父进程先返回子进程的pid(2252)，进入else，打印else里的语句；然后子进程返回0，进入if，打印if里的语句。</p>

        <p>有了<code class="highlighter-rouge">fork</code>调用，一个进程在接到新任务时就可以复制出一个子进程来处理新任务。但是windows没有fork调用，因此上面的代码无法在windows上运行。</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">multiprocessing</code>模块</p>

        <p>跨平台版本的多进程模块。multiprocessing模块提供了一个<code class="highlighter-rouge">Process</code>类来代表一个进程对象。下面的例子是启动一个子进程并等待其结束：</p>

        <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c"># 子进程要执行的代码</span>
<span class="k">def</span> <span class="nf">run_proc</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Run child process </span><span class="si">%</span><span class="s">s (</span><span class="si">%</span><span class="s">s)...'</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Parent process </span><span class="si">%</span><span class="s">s.'</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run_proc</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s">'test'</span><span class="p">,))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Child process will start.'</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Child process end.'</span><span class="p">)</span>

<span class="o">//</span><span class="err">执行结果：</span>
<span class="err">$</span> <span class="n">python3</span> <span class="n">testprocess</span><span class="o">.</span><span class="n">py</span>
<span class="n">Parent</span> <span class="n">process</span> <span class="mf">2258.</span>
<span class="n">Child</span> <span class="n">process</span> <span class="n">will</span> <span class="n">start</span><span class="o">.</span>
<span class="n">Run</span> <span class="n">child</span> <span class="n">process</span> <span class="n">test</span> <span class="p">(</span><span class="mi">2259</span><span class="p">)</span><span class="o">...</span>
<span class="n">Child</span> <span class="n">process</span> <span class="n">end</span><span class="o">.</span>
</code></pre>
        </div>

        <p>创建子进程只需要传入一个执行函数和函数的参数，创建一个<code class="highlighter-rouge">Process</code>实例；<code class="highlighter-rouge">start()</code>方法启动；<code class="highlighter-rouge">join()</code>方法等待子进程结束后再继续往下运行，通常用于进程间的同步。</p>

        <p>这样创建进程的方法比fork()还要简单。</p>

        <p><code class="highlighter-rouge">multiprocessing</code>模块还包装了底层的机制，提供了<code class="highlighter-rouge">Queue</code>、<code class="highlighter-rouge">Pipes</code>等多种方式来交换数据，实现进程间通信。</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">Pool</code></p>

        <p>用进程池的方式批量创建子进程：</p>

        <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">random</span>

<span class="k">def</span> <span class="nf">long_time_task</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Run task </span><span class="si">%</span><span class="s">s (</span><span class="si">%</span><span class="s">s)...'</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Task </span><span class="si">%</span><span class="s">s runs </span><span class="si">%0.2</span><span class="s">f seconds.'</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)))</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Parent process </span><span class="si">%</span><span class="s">s.'</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">long_time_task</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Waiting for all subprocesses done...'</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'All subprocesses done.'</span><span class="p">)</span>

<span class="o">//</span><span class="err">执行结果：</span>
<span class="n">Parent</span> <span class="n">process</span> <span class="mf">669.</span>
<span class="n">Waiting</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">subprocesses</span> <span class="n">done</span><span class="o">...</span>
<span class="n">Run</span> <span class="n">task</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">671</span><span class="p">)</span><span class="o">...</span>
<span class="n">Run</span> <span class="n">task</span> <span class="mi">1</span> <span class="p">(</span><span class="mi">672</span><span class="p">)</span><span class="o">...</span>
<span class="n">Run</span> <span class="n">task</span> <span class="mi">2</span> <span class="p">(</span><span class="mi">673</span><span class="p">)</span><span class="o">...</span>
<span class="n">Run</span> <span class="n">task</span> <span class="mi">3</span> <span class="p">(</span><span class="mi">674</span><span class="p">)</span><span class="o">...</span>
<span class="n">Task</span> <span class="mi">2</span> <span class="n">runs</span> <span class="mf">0.14</span> <span class="n">seconds</span><span class="o">.</span>
<span class="n">Run</span> <span class="n">task</span> <span class="mi">4</span> <span class="p">(</span><span class="mi">673</span><span class="p">)</span><span class="o">...</span>
<span class="n">Task</span> <span class="mi">1</span> <span class="n">runs</span> <span class="mf">0.27</span> <span class="n">seconds</span><span class="o">.</span>
<span class="n">Task</span> <span class="mi">3</span> <span class="n">runs</span> <span class="mf">0.86</span> <span class="n">seconds</span><span class="o">.</span>
<span class="n">Task</span> <span class="mi">0</span> <span class="n">runs</span> <span class="mf">1.41</span> <span class="n">seconds</span><span class="o">.</span>
<span class="n">Task</span> <span class="mi">4</span> <span class="n">runs</span> <span class="mf">1.91</span> <span class="n">seconds</span><span class="o">.</span>
<span class="n">All</span> <span class="n">subprocesses</span> <span class="n">done</span><span class="o">.</span>
</code></pre>
        </div>

        <p>分析：<code class="highlighter-rouge">p = Pool(4)</code>同时执行4个进程，所以task4要等待前面某个task完成后才执行。（<code class="highlighter-rouge">Pool</code>的默认大小是CPU的核数）</p>
      </li>
      <li>
        <p>子进程的输入输出</p>

        <p><code class="highlighter-rouge">subprocess</code>模块可以让我们非常方便地启动一个子进程，然后控制其输入和输出。</p>

        <p><code class="highlighter-rouge">r = subprocess.call(['nslookup', 'www.python.org'])</code>在Python代码中运行命令<code class="highlighter-rouge">nslookup www.python.org</code>。</p>

        <p>如果子进程还需要输入，则可以通过<code class="highlighter-rouge">communicate()</code>方法输入。</p>
      </li>
    </ul>
  </li>
</ul>

<hr />

<h4 id="正则表达式">正则表达式</h4>

<p><code class="highlighter-rouge">\d</code>可以匹配一个数字</p>

<p><code class="highlighter-rouge">\w</code>可以匹配一个字母或数字</p>

<p><code class="highlighter-rouge">.</code>可以匹配任意字符</p>

<p><code class="highlighter-rouge">*</code>表示任意个字符（包括0个）</p>

<p><code class="highlighter-rouge">+</code>表示至少一个字符</p>

<p><code class="highlighter-rouge">?</code>表示0个或1个字符</p>

<p><code class="highlighter-rouge"><span class="p">{</span><span class="err">n</span><span class="p">}</span></code>表示n个字符，<code class="highlighter-rouge"><span class="p">{</span><span class="err">n,m</span><span class="p">}</span></code>表示n-m个字符</p>

<p><code class="highlighter-rouge">\s</code>可以匹配一个空格（也包括Tab等空白符），所以<code class="highlighter-rouge">\s+</code>表示至少有一个空格</p>

<p>可以用<code class="highlighter-rouge">[]</code>表示范围</p>

<p><code class="highlighter-rouge">A|B</code>可以匹配A或B</p>

<p><code class="highlighter-rouge">^</code>表示行的开头</p>

<p><code class="highlighter-rouge">$</code>表示行的结束</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">match()</code>方法判断是否匹配，如果匹配成功，返回一个<code class="highlighter-rouge">Match</code>对象，否则返回<code class="highlighter-rouge">None</code>。</p>
  </li>
  <li>
    <p>Python提供<code class="highlighter-rouge">re</code>模块，包含所有正则表达式的功能。</p>
  </li>
  <li>
    <p>切分字符串：</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; re.split(r'[\s\,]+', 'a,b, c  d')
['a', 'b', 'c', 'd']
</code></pre>
    </div>
  </li>
  <li>
    <p>用<code class="highlighter-rouge">()</code>表示的就是要提取的分组（Group），比如：<code class="highlighter-rouge">^(\d{3})-(\d{3,8})$</code>分别定义了两个组<code class="highlighter-rouge">group(0)</code>永远是原始字符串，<code class="highlighter-rouge">group(1)</code>、<code class="highlighter-rouge">group(2)</code>……表示第1、2、……个子串。</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; m = re.match(r'^(\d{3})-(\d{3,8})$', '010-12345')
&gt;&gt;&gt; m
&lt;_sre.SRE_Match object; span=(0, 9), match='010-12345'&gt;
&gt;&gt;&gt; m.group(0)
'010-12345'
&gt;&gt;&gt; m.group(1)
'010'
&gt;&gt;&gt; m.group(2)
'12345'
</code></pre>
    </div>
  </li>
</ul>

<hr />

<h4 id="常用内建模块">常用内建模块</h4>

<ul>
  <li>
    <p><code class="highlighter-rouge">datetime</code></p>

    <p>处理日期和时间的标准库。这个模块可能会用得比较多。</p>

    <ul>
      <li>
        <p>获取当前日期和时间</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; now = datetime.now()
&gt;&gt;&gt; print(now)
2017-08-15 11:57:20.354422
</code></pre>
        </div>
      </li>
      <li>
        <p>获取指定日期和时间</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; dt = datetime(2019, 9, 9, 19, 30)
&gt;&gt;&gt; print(dt)
2019-09-09 19:30:00
</code></pre>
        </div>
      </li>
      <li>
        <p>datetime和timestamp的转换</p>

        <p>当前时间就是相对于epoch time（1970年1月1日 00:00:00 UTC+00:00）的秒数，称为timestamp。</p>

        <p>把一个<code class="highlighter-rouge">datetime</code>类型转换为timestamp只需要简单调用<code class="highlighter-rouge">timestamp()</code>方法：</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; dt = datetime(2015, 4, 19, 12, 20)
&gt;&gt;&gt; dt.timestamp() 
1429417200.0
</code></pre>
        </div>

        <p>要把timestamp转换为<code class="highlighter-rouge">datetime</code>，使用<code class="highlighter-rouge">datetime</code>提供的<code class="highlighter-rouge">fromtimestamp()</code>方法：</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; t = 543534523.0
&gt;&gt;&gt; print(datetime.fromtimestamp(t))
1987-03-24 05:48:43
</code></pre>
        </div>
      </li>
      <li>
        <p>datetime和str的转换</p>

        <p>通过<code class="highlighter-rouge">datetime.strptime()</code>实现把str转换为datetime：</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; cday = datetime.strptime('2019-10-1 12:03:00', '%Y-%m-%d %H:%M:%S')
&gt;&gt;&gt; print(cday)
2019-10-01 12:03:00
&gt;&gt;&gt; type(cday)
&lt;class 'datetime.datetime'&gt;
</code></pre>
        </div>

        <p>通过<code class="highlighter-rouge">strftime()</code>实现datetime转换成str：</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; now = datetime.now()
&gt;&gt;&gt; print(now.strftime('%a, %b %d %H:%M'))
Mon, May 05 16:28
</code></pre>
        </div>
      </li>
      <li>
        <p>datetime加减</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>&gt;&gt;&gt; from datetime import datetime, timedelta
&gt;&gt;&gt; now = datetime.now()
&gt;&gt;&gt; now
datetime.datetime(2017, 8, 15, 14, 13, 51, 222646)
&gt;&gt;&gt; now + timedelta(hours = 10)
datetime.datetime(2017, 8, 16, 0, 13, 51, 222646)
&gt;&gt;&gt; now + timedelta(days = 1)
datetime.datetime(2017, 8, 16, 14, 13, 51, 222646)
&gt;&gt;&gt; now + timedelta(days = 2, hours = 12)
datetime.datetime(2017, 8, 18, 2, 13, 51, 222646)
</code></pre>
        </div>
      </li>
    </ul>
  </li>
</ul>

<h3 id="开始学习python最佳实践指南">开始学习——python最佳实践指南</h3>

<h4 id="编程习语">编程习语</h4>

<ul>
  <li>
    <p><code class="highlighter-rouge">enumerate()</code> 会对list中的每个项提供包含两个元素的元组：<code class="highlighter-rouge">for index, item in enumerate(some_list)</code></p>
  </li>
  <li>
    <p>交换变量<code class="highlighter-rouge">a, b = b, a</code></p>
  </li>
  <li>
    <p>创建一个含N个对象的列表<code class="highlighter-rouge">four_nones = [None] * 4</code></p>
  </li>
  <li>
    <p>创建一个含N个列表的列表<code class="highlighter-rouge">four_lists = [[] for __ in range(4)]</code></p>
  </li>
  <li>
    <p>根据列表创建字符串:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>letter = ['s', 'p', 'a', 'm']
word = ''.join(letters)
</code></pre>
    </div>
  </li>
</ul>

<hr />

<h4 id="测试工具">测试工具</h4>

<ul>
  <li>py.test</li>
  <li>Nose</li>
  <li>tox</li>
  <li>Unittest2</li>
  <li>mock</li>
</ul>

<hr />

<h4 id="日志">日志</h4>

<p>日志的两个目的：</p>

<ul>
  <li>诊断日志。记录与应用程序操作相关的日志。</li>
  <li>审计日志。为商业分析而记录的日志。</li>
</ul>

<p>日志在某些时候优于打印的理由：</p>

<ul>
  <li>日志事件产生的日志记录，包含清晰可用的诊断信息，如文件名称、路径、函数名和行号等。</li>
  <li>包含日志模块的应用，默认可通过根记录器对应用的日志流进行访问，除非将日志过滤了。</li>
  <li>可通过<code class="highlighter-rouge"> logging.Logger.setLevel()</code>方法有选择地记录日志， 或可通过设置 <code class="highlighter-rouge">logging.Logger.disabled</code> 属性为 <code class="highlighter-rouge">True</code> 来禁用。</li>
</ul>

<hr />

<h4 id="常见陷阱">常见陷阱</h4>

<ul>
  <li>
    <p>可变默认参数</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>def append_to(element, to=[]):
    to.append(element)
    return to
      
my_list = append_to(12)
print(my_list)

my_other_list = append_to(42)
print(my_other_list)

#执行结果：
[12]
[12, 42]
</code></pre>
    </div>

    <p>执行结果却不是[12][42]</p>

    <p>当函数被定义时，一个新的列表就被创建 <em>一次</em> ，而且同一个列表在每次成功的调用中都被使用。</p>

    <p>改进：</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>def append_to(element, to=None):
    if to is None:
        to = []
    to.append(element)
    return to
</code></pre>
    </div>
  </li>
  <li>
    <p>迟绑定闭包</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>def create_multipliers():
    return [lambda x : i * x for i in range(5)]
for multiplier in create_multipliers():
    print multiplier(2)
      
#执行结果：
8
8
8
8
8
</code></pre>
    </div>

    <p>在返回的函数中引用了变量i，但不是立刻执行！</p>

    <p>这告诉我们：返回函数不要饮用循环变量，或者后续会发生变化的变量。</p>

    <p>如果一定要引用循环变量怎么办？方法是再创建一个函数，用该函数的参数绑定循环变量当前的值。</p>

    <p>改进：</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>def create_multipliers():
    return [lambda x, i=i : i * x for i in range(5)]
</code></pre>
    </div>
  </li>
</ul>

<hr />

<h3 id="学习中遇到的问题">学习中遇到的问题</h3>

<ol>
  <li>
    <div class="highlighter-rouge"><pre class="highlight"><code>def my_function(a, b):
    """
    &gt;&gt;&gt; my_function(2, 3)
    6
    &gt;&gt;&gt; my_function('a', 3)
    'aaa'
    """
    return a * b
</code></pre>
    </div>

    <p>要用<code class="highlighter-rouge">"""</code>还是<code class="highlighter-rouge">'''</code>?区别？</p>
  </li>
</ol>

</div>
<div class="share">
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
  </div>
  <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":["qzone","tsina","weixin","sqq"],"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/res/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</div>
<div class="pagination">

<a class="pagination-item newer" href="/2017/08/15/python4_BASE_3174.html"><i class="fa fa-arrow-left"></i>&nbsp;&nbsp;Python4_base_3174</a>


<a class="pagination-item older" href="/2017/08/15/python4_REMOTE_3174.html">Python学习4&nbsp;&nbsp;<i class="fa fa-arrow-right"></i></a>

</div>
<!-- 使用多说评论-->
<style>#ds-reset .ds-avatar, #ds-reset .ds-avatar img{border-radius:50%;}</style>
<script type="text/javascript">var duoshuoQuery = {short_name:"tingtinZ"};(function(){var ds = document.createElement('script');ds.type = 'text/javascript';ds.async = true;ds.src = '/res/js/embed.js';ds.charset = 'UTF-8';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);})();</script>
<div class="comments">
  <div class="ds-thread" data-title="Python学习4" data-thread-key="/2017/08/15/python4_LOCAL_3174" data-url="https://tingtinZ.github.io/2017/08/15/python4_LOCAL_3174.html"></div>
</div> 

<!-- 使用disqus评论-->

  <div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = "https://tingtinZ.github.io/2017/08/15/python4_LOCAL_3174.html";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://tingtinz.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    <script id="dsq-count-scr" src="//zshmobi.disqus.com/count.js" async></script>
  


    
    </div>
  </div>    
  <div id="top"><a id="rocket" href="javascript:;" title="返回顶部"><i></i></a></div>
  
</body>
</html>
